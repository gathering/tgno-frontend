---
import ThemeDark from "./icons/ThemeDark.astro";
import ThemeLight from "./icons/ThemeLight.astro";
---

<button
  id="theme-toggle"
  class="theme-toggle rounded-md text-gray-400 hover:text-foreground"
  aria-label="Toggle theme"
>
  <ThemeDark class="hidden" />
  <ThemeLight class="hidden" />
</button>

<script>
  declare function updateTheme(): void;

  const themeToggle = document.getElementById("theme-toggle");

  function updateThemeDisplay() {
    const current = localStorage.getItem("theme") || "dark";
    const dark = themeToggle?.querySelector("svg:nth-child(1)") as SVGElement;
    const light = themeToggle?.querySelector("svg:nth-child(2)") as SVGElement;

    for (const [theme, icon] of Object.entries({ dark, light })) {
      if (theme === current) {
        icon.classList.remove("hidden");
        icon.classList.add("block");
      } else {
        icon.classList.remove("block");
        icon.classList.add("hidden");
      }
    }
  }

  updateThemeDisplay();

  let toggles = 0;
  themeToggle?.addEventListener("click", () => {
    const current = localStorage.getItem("theme") || "dark";
    let next = current === "dark" ? "light" : "dark";
    localStorage.setItem("theme", next);

    toggles += 1;
    setTimeout(() => {
      toggles = Math.max(0, toggles - 1);
    }, 3000);

    if (toggles > 5 && next === "dark") {
      toggles = 0;
      triggerEasterEgg();
    }

    updateTheme();
    updateThemeDisplay();
  });

  function triggerEasterEgg() {
    const overlay = document.createElement("div");
    overlay.classList =
      "fixed inset-0 bg-black opacity-75 z-40 pointer-events-auto";
    document.body.appendChild(overlay);

    const box = document.createElement("div");
    box.classList =
      "fixed text-7xl sm:text-8xl md:text-9xl z-50 pointer-events-none animate-bounce top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-max";
    box.textContent = "â€¼ï¸ðŸ‘€ðŸ”¥â€¼ï¸";
    document.body.appendChild(box);

    setTimeout(() => {
      overlay.remove();
      box.remove();
    }, 3000);
  }
</script>
